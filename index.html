<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ForgeVerse ‚Äì A Pixel Economy on Solana</title>
  <meta name="description" content="ForgeVerse ‚Äì Pixel economy on Solana. Stake, Forge and Trade to grow your NFT empire."/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet"/>

  <!-- STYLES -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{
      font-family:'VT323',monospace;
      font-size:18px;
      color:#fff;
      background:#0D0D0F;
      scroll-behavior:smooth;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none;}
    .container{width:90%;max-width:1200px;margin:0 auto;}

    body{position:relative;}
    body::before{
      content:"";
      position:fixed;inset:0;z-index:0;pointer-events:none;
      background:
        repeating-linear-gradient(to right,rgba(102,250,255,.08)0 1px,transparent 1px 32px),
        repeating-linear-gradient(to bottom,rgba(102,250,255,.08)0 1px,transparent 1px 32px);
      opacity:.28;
    }
    .header,.hero,.section,.footer{position:relative;z-index:1;}

    .header{
      background:#0D0D0F;
      border-bottom:2px solid #66FAFF;
      padding:18px 0;
      position:sticky;top:0;z-index:50;
    }
    .header__inner{
      display:flex;align-items:center;justify-content:space-between;
      gap:16px;flex-wrap:wrap;
    }
    .brand__name{
      font-family:'Press Start 2P';
      font-size:16px;
      color:#66FAFF;
      text-shadow:0 0 5px #66FAFF,0 0 15px #33F0FF,0 0 25px #00BFFF;
    }
    .nav{
      display:flex;flex-wrap:wrap;gap:16px;
      font-family:'Press Start 2P';font-size:10px;
    }
    .nav a{transition:color .2s,text-shadow .2s;}
    .nav a:hover{color:#66FAFF;text-shadow:0 0 6px #33F0FF;}

    .btn{
      font-family:'Press Start 2P';
      border:2px solid #66FAFF;
      color:#66FAFF;
      background:transparent;
      padding:12px 20px;
      font-size:12px;
      cursor:pointer;
      letter-spacing:1px;
      transition:all .2s;
    }
    .btn--primary{background:#FFB347;color:#0D0D0F;border-color:#FFB347;}
    .btn--primary:hover{box-shadow:0 0 20px #FFB347AA;transform:translateY(-2px);}
    .btn--secondary{border-color:#66FAFF;color:#66FAFF;}
    .btn--secondary:hover{box-shadow:0 0 20px #66FAFFAA;transform:translateY(-2px);}
    .btn--wallet{
      background:#FFB347;color:#0D0D0F;border-color:#FFB347;
      font-size:10px;padding:10px 14px;
      box-shadow:0 0 8px #FFB34755;
    }
    .btn--wallet:hover{box-shadow:0 0 16px #FFB347AA;transform:translateY(-2px);}
    .btn--connected{background:#66FAFF;border-color:#66FAFF;color:#0D0D0F;}

    .hero{position:relative;text-align:center;padding:100px 0;}
    .title{
      font-family:'Press Start 2P';
      font-size:28px;
      color:#66FAFF;
      text-shadow:0 0 4px #66FAFF,0 0 10px #66FAFF,0 0 20px #33F0FF;
      margin-bottom:20px;
    }
    .subtitle{font-size:22px;color:#fff;margin-bottom:30px;}
    .hero__cta{display:flex;justify-content:center;gap:20px;}

    .section{padding:80px 0;}
    .section__title{
      font-family:'Press Start 2P';
      color:#FFB347;
      font-size:16px;
      margin-bottom:25px;
    }
    .section__text{
      font-size:20px;
      line-height:1.6;
      max-width:900px;
      margin-bottom:30px;
    }

    .cards{display:flex;gap:20px;flex-wrap:wrap;margin-top:22px;}
    .fv-card{
      flex:1 1 220px;min-height:72px;
      background:#0D0D0F;color:#66FAFF;cursor:pointer;
      border:2px solid #66FAFF;border-radius:8px;
      font-family:'Press Start 2P';font-size:12px;
      display:flex;align-items:center;justify-content:center;
      transition:transform .1s,box-shadow .15s;
    }
    .fv-card:hover{transform:translateY(-2px);box-shadow:0 0 14px #66FAFF55;}

    .fv-viewer{
      position:relative;
      border:2px solid #66FAFF;
      box-shadow:0 0 20px #00ffff55;
      border-radius:12px;
      background:#0D0D0F;
      overflow:hidden;
      max-height:0;
      opacity:0;
      margin-top:0;
      transition:max-height .5s,opacity .4s,margin-top .3s;
    }
    .fv-viewer.show{max-height:900px;opacity:1;margin-top:24px;}
    .fv-viewer iframe{border:none;width:100%;height:820px;border-radius:12px;}
    .fv-close{
      position:absolute;top:10px;right:15px;
      background:#0D0D0F;color:#FFB347;
      border:2px solid #FFB347;border-radius:6px;
      font-family:'Press Start 2P';font-size:10px;
      padding:8px 10px;cursor:pointer;
      box-shadow:0 0 10px #FFB34755;z-index:2;
      transition:all .2s;
    }
    .fv-close:hover{background:#FFB347;color:#0D0D0F;}

    .btn--ghost-cyan{
      background:transparent;color:#66FAFF;border:2px solid #66FAFF;
      font-family:'Press Start 2P';padding:10px 16px;
      display:inline-flex;align-items:center;gap:8px;
      box-shadow:0 0 10px rgba(102,250,255,.35);
      transition:box-shadow .2s,transform .1s;
    }
    .btn--ghost-cyan:hover{box-shadow:0 0 18px rgba(102,250,255,.65);transform:translateY(-2px);}
    .chat-users{
      background:#66FAFF22;color:#FFB347;
      border:1px solid #66FAFF55;border-radius:6px;
      padding:4px 6px;font-size:10px;
    }
    .btn--close-orange{
      background:#FFB347;color:#0D0D0F;border:2px solid #FFB347;
      font-family:'Press Start 2P';padding:8px 12px;
      transition:box-shadow .2s,transform .1s;
    }
    .btn--close-orange:hover{box-shadow:0 0 16px rgba(255,179,71,.65);transform:translateY(-2px);}
    .chat-panel{
      overflow:hidden;max-height:0;opacity:0;margin-top:0;
      transition:max-height .5s,opacity .4s,margin-top .3s;
    }
    .chat-panel.show{max-height:820px;opacity:1;margin-top:18px;}
    .chat-container{
      border:2px solid #66FAFF;border-radius:12px;
      background:#0D0D0F;padding:12px;
      box-shadow:0 0 20px rgba(0,255,255,.35);
    }
    .chat-actions{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;margin-top:10px;
    }
    .powered-by-minnit{margin:0;font-size:10px;color:#8aa;}
    .powered-by-minnit a{color:#66FAFF;}
    .powered-by-minnit a:hover{text-decoration:underline;color:#FFB347;}

    .modal{position:fixed;inset:0;display:none;z-index:1000;}
    .modal.show{display:block;}
    .modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);}
    .modal__content{
      position:relative;margin:6vh auto 0;width:min(720px,92%);
      background:#0D0D0F;border:2px solid #66FAFF;border-radius:12px;
      box-shadow:0 0 24px rgba(0,255,255,.35);
      padding:22px 18px 18px;
      animation:popIn .18s ease-out;
    }
    @keyframes popIn{from{transform:scale(.98);opacity:.7}to{transform:scale(1);opacity:1}}
    .modal__close{
      position:absolute;right:12px;top:10px;
      background:#0D0D0F;color:#FFB347;
      border:2px solid #FFB347;border-radius:6px;
      font-family:'Press Start 2P';font-size:10px;
      padding:6px 8px;cursor:pointer;
    }
    .modal__close:hover{background:#FFB347;color:#0D0D0F;}
    .modal__title{font-family:'Press Start 2P';color:#66FAFF;font-size:16px;margin-bottom:10px;text-shadow:0 0 6px #33F0FF;}
    .modal__subtitle{color:#ddd;font-size:18px;margin-bottom:18px;}
    .mint-form{display:flex;flex-direction:column;gap:16px;}
    .mint-row{display:flex;align-items:center;gap:16px;flex-wrap:wrap;}
    .mint-label{width:140px;font-family:'Press Start 2P';font-size:10px;color:#FFB347;}
    .mint-options{display:flex;gap:14px;flex-wrap:wrap;}
    .opt{display:inline-flex;align-items:center;gap:8px;font-size:18px;cursor:pointer;}
    .opt input{transform:scale(1.2);}
    .mint-input{
      flex:1 1 180px;max-width:180px;
      background:#0D0D0F;color:#fff;
      border:2px solid #66FAFF;border-radius:8px;
      padding:10px 12px;font-size:18px;outline:none;
      box-shadow:0 0 10px rgba(102,250,255,.25) inset;
    }
    .mint-input:focus{box-shadow:0 0 16px rgba(102,250,255,.5) inset;}
    .mint-chip{
      display:inline-block;padding:8px 10px;
      border:2px solid #66FAFF;border-radius:8px;
      color:#66FAFF;font-family:'Press Start 2P';font-size:10px;
    }
    .mint-summary{
      border:2px solid #66FAFF;border-radius:12px;
      padding:12px;box-shadow:0 0 16px rgba(0,255,255,.2) inset;
    }
    .sum-line{display:flex;align-items:center;justify-content:space-between;font-size:18px;margin:6px 0;}
    .sum-line.total span{color:#FFB347;font-family:'Press Start 2P';font-size:12px;}
    .sum-line.total strong{color:#FFB347;}
    .terms{display:flex;align-items:flex-start;gap:10px;font-size:16px;line-height:1.4;color:#ccc;}
    .terms input{transform:translateY(2px)scale(1.1);}
    .mint-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:8px;}
    .mint-status{margin-top:14px;min-height:24px;font-size:16px;color:#66FAFF;white-space:pre-line;}

    .footer{
      border-top:2px solid #66FAFF;
      background:#0D0D0F;
      padding:60px 0 30px;
    }
    .footer__grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:40px;margin-bottom:30px;
    }
    .footer__title{color:#FFB347;font-family:'Press Start 2P';font-size:12px;margin-bottom:15px;}
    .footer__list{list-style:none;font-size:14px;}
    .footer__list li{margin-bottom:8px;}
    .footer__list a:hover{color:#66FAFF;}
    .brand--footer{display:flex;align-items:center;gap:10px;}
    .brand__box{
      width:36px;height:36px;display:flex;align-items:center;justify-content:center;
      border:2px solid #66FAFF;color:#0D0D0F;background:#66FAFF;font-weight:bold;
    }
    .muted{color:#ccc;}
    .divider{height:1px;background:linear-gradient(90deg,#66FAFF,#FFB347,#66FAFF);margin:30px 0;}
    .neon-glow{text-shadow:0 0 4px #66FAFF,0 0 10px #66FAFF,0 0 20px #33F0FF;}
    @keyframes glowPulse{
      0%,100%{text-shadow:0 0 4px #66FAFF,0 0 10px #66FAFF,0 0 20px #33F0FF;}
      50%{text-shadow:0 0 2px #66FAFF,0 0 6px #33F0FF,0 0 14px #00E0FF;}
    }
    .neon-glow-animated{animation:glowPulse 2.5s infinite ease-in-out;}

    /* GAME */
    .game-wrap{
      border:2px solid #66FAFF;border-radius:12px;
      padding:16px;background:#0D0D0F;
      box-shadow:0 0 20px rgba(0,255,255,.25) inset,0 0 20px rgba(0,255,255,.25);
    }
    .game-player{
      display:flex;flex-wrap:wrap;align-items:center;gap:10px;
      margin-bottom:10px;
    }
    .game-player label{
      font-family:'Press Start 2P';font-size:10px;color:#FFB347;
    }
    #playerName{
      background:#0D0D0F;color:#fff;
      border:2px solid #66FAFF;border-radius:8px;
      padding:6px 10px;font-size:16px;min-width:160px;
      box-shadow:0 0 10px rgba(102,250,255,.25) inset;
    }
    #playerName:focus{outline:none;box-shadow:0 0 16px rgba(102,250,255,.5) inset;}
    .game-player-note{font-size:14px;color:#aaa;}

    .game-hud{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;margin-bottom:12px;flex-wrap:wrap;
    }
    .hud-group{display:flex;align-items:center;gap:8px;}
    .hud-label{font-family:'Press Start 2P';font-size:10px;color:#FFB347;}
    .hud-val{font-size:20px;color:#66FAFF;min-width:40px;text-align:right;}
    .hud-actions .btn{padding:8px 12px;font-size:10px;}

    .game-stage{
      position:relative;
      display:flex;justify-content:center;align-items:center;
      background:#020205;border:2px solid #66FAFF;border-radius:10px;overflow:hidden;
    }
    #pmCanvas{display:block;width:100%;height:auto;image-rendering:pixelated;}
    .game-overlay{
      position:absolute;inset:0;
      display:none;align-items:center;justify-content:center;
      background:linear-gradient(180deg,transparent,rgba(13,13,15,.8));
      color:#66FAFF;text-shadow:0 0 8px #33F0FF;
      font-family:'Press Start 2P';font-size:14px;
      text-align:center;padding:20px;
    }
    .game-overlay.show{display:flex;}

    .game-bottom{
      display:flex;flex-wrap:wrap;gap:20px;
      margin-top:14px;align-items:flex-start;
    }
    .game-controls{
      flex:1 1 200px;
      display:flex;flex-direction:column;align-items:center;gap:8px;
    }
    .game-hint{font-size:16px;color:#a8d;text-align:center;}
    .dpad{
      display:grid;
      grid-template-columns:repeat(3,48px);
      grid-template-rows:repeat(3,48px);
      gap:6px;
    }
    .dpad-btn{
      background:#0D0D0F;
      border:2px solid #66FAFF;
      color:#66FAFF;
      font-family:'Press Start 2P';
      font-size:14px;
      cursor:pointer;
      box-shadow:0 0 10px rgba(102,250,255,.35);
    }
    .dpad-btn:active{transform:translateY(1px);box-shadow:0 0 4px rgba(102,250,255,.5);}
    .dpad-btn.empty{border:none;box-shadow:none;background:transparent;cursor:default;}

    .leaderboard{
      flex:1 1 260px;
      border:2px solid #66FAFF;border-radius:10px;
      padding:10px;
      box-shadow:0 0 16px rgba(0,255,255,.25) inset;
      max-width:360px;
    }
    .leaderboard h3{
      font-family:'Press Start 2P';font-size:12px;color:#FFB347;margin-bottom:8px;
    }
    .leaderboard small{font-size:12px;color:#aaa;}
    .lb-table{width:100%;border-collapse:collapse;margin-top:8px;font-size:16px;}
    .lb-table th,.lb-table td{padding:4px 4px;text-align:left;}
    .lb-table th{border-bottom:1px solid #66FAFF;font-size:12px;color:#66FAFF;}
    .lb-table td.score{text-align:right;}
    .lb-empty{font-size:14px;color:#888;margin-top:4px;}

    @media(min-width:900px){
      .game-stage{max-width:448px;margin:0 auto;}
    }
    @media(max-width:900px){
      .title{font-size:24px;}
      .hero__cta{flex-direction:column;gap:12px;}
      .btn{width:100%;}
      .fv-viewer iframe{height:620px;}
      .fv-viewer.show{max-height:700px;}
      .chat-panel.show{max-height:680px;}
    }
    @media(max-width:560px){
      .nav{display:none;}
    }
  </style>
</head>

<body id="top">
  <!-- HEADER -->
  <header class="header">
    <div class="container header__inner">
      <a class="brand" href="#top"><span class="brand__name neon-glow neon-glow-animated">ForgeVerse</span></a>
      <nav class="nav">
        <a href="#about">About</a>
        <a href="#mint">Mint</a>
        <a href="#nfts">NFTs</a>
        <a href="#stake">Stake</a>
        <a href="#fusion">Fusion</a>
        <a href="#game">Game</a>
        <a href="#ranking">Ranking</a>
        <a href="#merch">Merch</a>
        <a href="#chat">Chat</a>
      </nav>
      <button id="connectBtn" class="btn btn--wallet">Install Phantom</button>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero__inner">
      <h1 class="title neon-glow-animated">A Pixel Economy on Solana</h1>
      <p class="subtitle">Stake, Forge &amp; Trade to grow your NFT empire.</p>
      <div class="hero__cta">
        <a href="#mint" class="btn btn--primary">Mint your NFT</a>
        <a href="#about" class="btn btn--secondary">Read Docs</a>
      </div>
    </div>
  </section>

  <!-- ABOUT + DOCS -->
  <section id="about" class="section">
    <div class="container">
      <h2 class="section__title">About</h2>
      <p class="section__text">
        ForgeVerse connects NFTs, gaming, and a resource-driven economy. Each NFT has a role:
        <strong>Traders</strong> earn $DOLLAR, <strong>Farmers</strong> grow $FOOD, and
        <strong>Workers</strong> mine $METAL. Use resources to feed, forge, and fuse your NFTs.
      </p>

      <div id="fv-docs-cards" class="cards">
        <button data-doc="whitepaper" class="fv-card">Whitepaper</button>
        <button data-doc="pitchdeck"  class="fv-card">Pitchdeck</button>
        <button data-doc="roadmap"    class="fv-card">Roadmap</button>
      </div>

      <div id="fv-docs-viewer" class="fv-viewer">
        <button id="fv-close-btn" class="fv-close">‚úï CLOSE</button>
        <iframe id="fv-docs-frame" src="" width="100%" height="820" loading="lazy"></iframe>
      </div>
    </div>
  </section>

  <!-- ============================== -->
<!--     FORGEVERSE PITCHDECK      -->
<!-- ============================== -->

<section id="pitchdeck" class="pitchdeck-section">
  <h2 class="section__title neon-glow">ForgeVerse Pitchdeck</h2>

  <div class="pd-controls">
    <button id="pd-prev" class="pd-btn">‚óÄ Prev</button>
    <span id="pd-counter">Slide 1 / 13</span>
    <button id="pd-next" class="pd-btn">Next ‚ñ∂</button>
  </div>

  <div id="pitchdeck-slides" class="pd-slides">

    <div class="pd-slide active">
      <h3>ForgeVerse</h3>
      <p>A Pixel Economy on Solana<br><br>ForgeVerse Labs</p>
    </div>

    <div class="pd-slide">
      <h3>Problem</h3>
      <p>
        ‚Ä¢ Web3 games lack real utility<br>
        ‚Ä¢ NFT ecosystems collapse fast<br>
        ‚Ä¢ No skill-based earning loops
      </p>
    </div>

    <div class="pd-slide">
      <h3>Solution</h3>
      <p>
        NFTs with functional roles:<br>
        ‚Ä¢ Traders ‚Üí $DOLLAR<br>
        ‚Ä¢ Farmers ‚Üí $FOOD<br>
        ‚Ä¢ Workers ‚Üí $METAL
      </p>
    </div>

    <div class="pd-slide">
      <h3>Ecosystem</h3>
      <p>
        Balanced 3-token economy powering<br>
        crafting, staking, fusing and upgrades.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Game Loop</h3>
      <p>
        Play ‚Üí Earn ‚Üí Upgrade ‚Üí Fuse ‚Üí Repeat<br>
        Skill-based reward multiplier.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Token Utility</h3>
      <p>
        $DOLLAR ‚Üí Trading upgrades<br>
        $FOOD ‚Üí Energy<br>
        $METAL ‚Üí Tools & crafting
      </p>
    </div>

    <div class="pd-slide">
      <h3>NFT Roles</h3>
      <p>
        Each role has synergy.<br>
        Fusion unlocks stronger NFTs.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Marketplace</h3>
      <p>
        Trade NFTs, resources, upgrades,<br>
        tools and forged items.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Staking</h3>
      <p>
        Stake NFTs to earn resources<br>
        based on class stats & rarity.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Fusion</h3>
      <p>
        Combine NFTs using FOOD + METAL<br>
        to generate stronger versions.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Roadmap</h3>
      <p>
        Phase 1 ‚Äì NFT Launch<br>
        Phase 2 ‚Äì Game Beta<br>
        Phase 3 ‚Äì Mobile Expansion
      </p>
    </div>

    <div class="pd-slide">
      <h3>Team</h3>
      <p>
        ForgeVerse Labs ‚Äì Blockchain engineers,<br>
        artists & game developers.
      </p>
    </div>

    <div class="pd-slide">
      <h3>Call to Action</h3>
      <p>
        Join the ForgeVerse.<br>
        Mint ‚Ä¢ Play ‚Ä¢ Earn ‚Ä¢ Build.
      </p>
    </div>

  </div>
</section>

<!-- Pitchdeck Script -->
<script>
(function(){
  const slides = document.querySelectorAll(".pd-slide");
  let index = 0;

  const counter = document.getElementById("pd-counter");
  const prev = document.getElementById("pd-prev");
  const next = document.getElementById("pd-next");

  function update(){
    slides.forEach(s => s.classList.remove("active"));
    slides[index].classList.add("active");
    counter.textContent = "Slide " + (index+1) + " / " + slides.length;
  }

  next.onclick = () => { index = (index+1) % slides.length; update(); };
  prev.onclick = () => { index = (index-1+slides.length) % slides.length; update(); };

  update();
})();
</script>

  <!-- MINT -->
  <section id="mint" class="section">
    <div class="container">
      <h2 class="section__title">Mint your NFT</h2>
      <p class="section__text">Choose your role and mint. (Demo modal until live Candy Machine is connected.)</p>
      <button id="openMintModal" class="btn btn--primary">Mint (Demo)</button>
    </div>
  </section>

  <!-- SIMPLE SECTIONS -->
  <section id="nfts" class="section"><div class="container"><h2 class="section__title">Your NFTs</h2><p class="section__text">Your owned NFTs will appear here after wallet connect.</p></div></section>
  <section id="stake" class="section"><div class="container"><h2 class="section__title">Stake your NFTs</h2><p class="section__text">Stake NFTs and earn $FOOD, $METAL or $DOLLAR.</p></div></section>
  <section id="fusion" class="section"><div class="container"><h2 class="section__title">Fusion Lab</h2><p class="section__text">Fuse two NFTs using resources to obtain a stronger NFT.</p></div></section>

  <!-- GAME -->
  <section id="game" class="section">
    <div class="container">
      <h2 class="section__title">Game ‚Äì Pixel Pac</h2>
      <p class="section__text">
        Collect all pellets, avoid ghosts. Use <strong>Arrow Keys</strong> or <strong>WASD</strong>.
        Scores are stored locally on this device.
      </p>

      <div class="game-wrap">
        <div class="game-player">
          <label for="playerName">Player Name</label>
          <input id="playerName" type="text" maxlength="16" placeholder="ForgePlayer"/>
          <span class="game-player-note">(shown in the local highscore)</span>
        </div>

        <div class="game-hud">
          <div class="hud-group">
            <span class="hud-label">Score</span><span id="pmScore" class="hud-val">0</span>
          </div>
          <div class="hud-group">
            <span class="hud-label">Lives</span><span id="pmLives" class="hud-val">3</span>
          </div>
          <div class="hud-actions">
            <button id="pmStart" class="btn btn--primary">Start</button>
            <button id="pmReset" class="btn btn--secondary">Reset</button>
          </div>
        </div>

        <div class="game-stage">
          <canvas id="pmCanvas" width="448" height="496"></canvas>
          <div id="pmOverlay" class="game-overlay"></div>
        </div>

        <div class="game-bottom">
          <div class="game-controls">
            <div class="dpad">
              <button class="dpad-btn empty"></button>
              <button id="btnUp" class="dpad-btn">‚ñ≤</button>
              <button class="dpad-btn empty"></button>

              <button id="btnLeft" class="dpad-btn">‚óÄ</button>
              <button class="dpad-btn empty"></button>
              <button id="btnRight" class="dpad-btn">‚ñ∂</button>

              <button class="dpad-btn empty"></button>
              <button id="btnDown" class="dpad-btn">‚ñº</button>
              <button class="dpad-btn empty"></button>
            </div>
            <p class="game-hint">Tip: Power pellets (‚óè) let you eat ghosts for a few seconds.</p>
          </div>

          <div class="leaderboard">
            <h3>Highscores</h3>
            <small>Local only ‚Äì stored in your browser.</small>
            <table class="lb-table">
              <thead>
                <tr><th>#</th><th>Player</th><th class="score">Score</th></tr>
              </thead>
              <tbody id="scoreBody"></tbody>
            </table>
            <p id="lbEmpty" class="lb-empty">Play a game to create your first score.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="ranking" class="section"><div class="container"><h2 class="section__title">Ranking</h2><p class="section__text">Leaderboard for top players &amp; collectors (on-chain version later).</p></div></section>
  <section id="merch" class="section"><div class="container"><h2 class="section__title">Merch Store</h2><p class="section__text">Exclusive ForgeVerse gear with NFT-holder discounts.</p></div></section>

  <!-- CHAT -->
  <section id="chat" class="section">
    <div class="container">
      <h2 class="section__title">Community Chat</h2>
      <p class="section__text">Chat with ForgeVerse players in real time. Share tips, strategies and creations.</p>

      <button id="chatToggleBtn" class="btn btn--ghost-cyan" aria-expanded="false" aria-controls="chatPanel">
        <span id="chatToggleLabel">‚ñ∏ Open Chat</span>
        <span id="chatUsers" class="chat-users">Online: 12</span>
      </button>

      <div id="chatPanel" class="chat-panel">
        <div class="chat-container">
          <script src="https://minnit.chat/js/embed.js?c=1758971289" defer></script>
          <span
            class="minnit-chat-sembed"
            data-chatname="https://organizations.minnit.chat/363196062352045/c/Main?embed"
            data-style="width:100%; height:500px; max-height:90vh;"
            data-version="1.55"
          >Chat</span>
          <div class="chat-actions">
            <button id="chatCloseBtn" class="btn btn--close-orange">‚úï Close Chat</button>
            <p class="powered-by-minnit">
              <a href="https://minnit.chat" target="_blank" rel="noreferrer">Powered by Minnit Chat</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <div class="footer__grid">
        <div>
          <div class="brand brand--footer">
            <div class="brand__box">FV</div>
            <span class="brand__name neon-glow">ForgeVerse</span>
          </div>
          <p class="muted">A Pixel Economy on Solana</p>
          <div class="socials">
            <a href="#" target="_blank">Twitter</a>
            <a href="#" target="_blank">Telegram</a>
            <a href="#" target="_blank">GitHub</a>
            <a href="#" target="_blank">Discord</a>
          </div>
        </div>
        <div>
          <h3 class="footer__title">Quick Links</h3>
          <ul class="footer__list">
            <li><a href="#about">About</a></li>
            <li><a href="#mint">Mint NFT</a></li>
            <li><a href="#stake">Stake</a></li>
            <li><a href="#fusion">Fusion Lab</a></li>
          </ul>
        </div>
        <div>
          <h3 class="footer__title">Community</h3>
          <ul class="footer__list">
            <li><a href="#game">Game</a></li>
            <li><a href="#ranking">Ranking</a></li>
            <li><a href="#merch">Merch</a></li>
            <li><a href="#chat">Chat</a></li>
          </ul>
        </div>
        <div>
          <h3 class="footer__title">Legal</h3>
          <ul class="footer__list">
            <li><a href="#">Terms of Service</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#about">Whitepaper</a></li>
            <li><a href="#">FAQ</a></li>
          </ul>
        </div>
      </div>
      <div class="divider"></div>
      <div class="copyright">
        <p class="neon-glow">¬© 2025 ForgeVerse Labs</p>
        <p>Built on Solana ‚Ä¢ Powered by the Community</p>
      </div>
    </div>
  </footer>

  <!-- DOCS SCRIPT -->
  <script>
    (function(){
      const DOCS = {
        whitepaper:"https://drive.google.com/file/d/1QGnx0QtJHX5SH0qMnDksHnqTYU9S6U5o/preview",
        pitchdeck :"https://drive.google.com/file/d/1GAAIlu69a2IzVHh3-MJVKySi_-tdMGGG/preview",
        roadmap   :"https://drive.google.com/file/d/1BZcNeluxr7n2-KBxQb-LPPeFNgrI-IkU/preview"
      };
      const cards  = document.querySelectorAll('#fv-docs-cards .fv-card');
      const viewer = document.getElementById('fv-docs-viewer');
      const frame  = document.getElementById('fv-docs-frame');
      const close  = document.getElementById('fv-close-btn');

      function openDoc(url){
        if(frame.src === url && viewer.classList.contains('show')){ closeViewer(); return; }
        frame.src = url;
        viewer.classList.add('show');
        const top = viewer.getBoundingClientRect().top + window.pageYOffset - 90;
        window.scrollTo({ top, behavior:'smooth' });
      }
      function closeViewer(){
        viewer.classList.remove('show');
        setTimeout(()=>{ frame.src=''; }, 450);
      }
      cards.forEach(btn=>btn.addEventListener('click',()=>openDoc(DOCS[btn.dataset.doc])));
      close.addEventListener('click', closeViewer);
    })();
  </script>

  <!-- CHAT SCRIPT -->
  <script>
    (function(){
      const btn    = document.getElementById('chatToggleBtn');
      const label  = document.getElementById('chatToggleLabel');
      const panel  = document.getElementById('chatPanel');
      const close  = document.getElementById('chatCloseBtn');
      const users  = document.getElementById('chatUsers');

      panel.classList.remove('show'); panel.style.maxHeight='0px'; panel.style.opacity='0';
      btn.setAttribute('aria-expanded','false'); label.textContent='‚ñ∏ Open Chat';

      function updateUsers(){ const n = 10 + Math.floor(Math.random()*15); users.textContent='Online: '+n; }
      setInterval(updateUsers, 8000);

      function openChat(){
        panel.classList.add('show');
        panel.style.maxHeight = panel.scrollHeight + 'px';
        panel.style.opacity   = '1';
        btn.setAttribute('aria-expanded','true');
        label.textContent = '‚ñæ Close Chat';
        const top = panel.getBoundingClientRect().top + window.pageYOffset - 90;
        window.scrollTo({ top, behavior:'smooth' });
      }
      function closeChat(){
        panel.style.maxHeight = panel.scrollHeight + 'px';
        requestAnimationFrame(()=>{
          panel.classList.remove('show');
          panel.style.maxHeight='0px';
          panel.style.opacity='0';
        });
        btn.setAttribute('aria-expanded','false');
        label.textContent='‚ñ∏ Open Chat';
      }

      btn.addEventListener('click', ()=> (btn.getAttribute('aria-expanded')==='true') ? closeChat() : openChat());
      close.addEventListener('click', e=>{ e.preventDefault(); closeChat(); });
      window.addEventListener('resize', ()=>{ if(btn.getAttribute('aria-expanded')==='true') panel.style.maxHeight=panel.scrollHeight+'px'; });
    })();
  </script>

  <!-- MINT MODAL -->
  <div id="mintModal" class="modal" aria-hidden="true">
    <div class="modal__backdrop" data-close="true"></div>
    <div class="modal__content">
      <button class="modal__close" data-close="true">‚úï</button>
      <h3 class="modal__title">Mint ForgeVerse NFT</h3>
      <p class="modal__subtitle">Pick your role, set quantity, confirm &amp; mint.</p>
      <form id="mintForm" class="mint-form" autocomplete="off">
        <div class="mint-row">
          <label class="mint-label">Role</label>
          <div class="mint-options">
            <label class="opt"><input type="radio" name="role" value="Trader" checked> Trader ($DOLLAR)</label>
            <label class="opt"><input type="radio" name="role" value="Farmer"> Farmer ($FOOD)</label>
            <label class="opt"><input type="radio" name="role" value="Worker"> Worker ($METAL)</label>
          </div>
        </div>
        <div class="mint-row">
          <label for="mintQty" class="mint-label">Quantity</label>
          <input id="mintQty" class="mint-input" type="number" min="1" max="10" step="1" value="1"/>
        </div>
        <div class="mint-row">
          <label class="mint-label">Network</label>
          <div class="mint-chip">Solana (Demo)</div>
        </div>
        <div class="mint-summary">
          <div class="sum-line"><span>Price per mint</span><strong id="priceEach">0.10 SOL</strong></div>
          <div class="sum-line"><span>Quantity</span><strong id="qtyView">1</strong></div>
          <div class="sum-line total"><span>Total</span><strong id="totalView">0.10 SOL</strong></div>
        </div>
        <label class="terms">
          <input type="checkbox" id="acceptTerms"/> I accept that this is a demo mint (no on-chain transaction).
        </label>
        <div class="mint-actions">
          <button type="button" id="mintNowBtn" class="btn btn--primary" disabled>Mint Now</button>
          <button type="button" class="btn btn--secondary" data-close="true">Cancel</button>
        </div>
      </form>
      <div id="mintStatus" class="mint-status"></div>
    </div>
  </div>

  <script>
    (function(){
      const OPEN  = document.getElementById('openMintModal');
      const MODAL = document.getElementById('mintModal');
      const CLOSES= MODAL.querySelectorAll('[data-close]');
      const QTY   = document.getElementById('mintQty');
      const PRICE_EACH = 0.10;
      const priceEachEl= document.getElementById('priceEach');
      const qtyViewEl  = document.getElementById('qtyView');
      const totalViewEl= document.getElementById('totalView');
      const TERMS      = document.getElementById('acceptTerms');
      const BTN_MINT   = document.getElementById('mintNowBtn');
      const STATUS     = document.getElementById('mintStatus');

      priceEachEl.textContent = PRICE_EACH.toFixed(2)+' SOL';
      function updateTotals(){
        const q = Math.min(10, Math.max(1, parseInt(QTY.value||'1',10)));
        QTY.value = q;
        qtyViewEl.textContent = q;
        totalViewEl.textContent = (q*PRICE_EACH).toFixed(2)+' SOL';
        BTN_MINT.disabled = !TERMS.checked;
      }
      updateTotals();
      QTY.addEventListener('input', updateTotals);
      TERMS.addEventListener('change', updateTotals);

      function openModal(){ MODAL.classList.add('show'); MODAL.setAttribute('aria-hidden','false'); STATUS.textContent=''; }
      function closeModal(){ MODAL.classList.remove('show'); MODAL.setAttribute('aria-hidden','true'); }

      OPEN.addEventListener('click', openModal);
      CLOSES.forEach(el=>el.addEventListener('click', closeModal));
      MODAL.addEventListener('click', e=>{ if(e.target && e.target.dataset && e.target.dataset.close==='true') closeModal(); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && MODAL.classList.contains('show')) closeModal(); });

      BTN_MINT.addEventListener('click', async ()=>{
        if (BTN_MINT.disabled) return;
        BTN_MINT.disabled = true;
        STATUS.textContent = 'Connecting wallet...';
        const provider = window.solana || (window.phantom && window.phantom.solana) || null;
        await new Promise(r=>setTimeout(r,700));
        STATUS.textContent = (provider && provider.isPhantom)
          ? 'Wallet connected.\nMinting...'
          : 'No Phantom detected. Proceeding in demo mode...\nMinting...';
        await new Promise(r=>setTimeout(r,1000));
        const qty = parseInt(QTY.value||'1',10);
        const role = (document.querySelector('input[name="role"]:checked')||{value:'Trader'}).value;
        const fakeHash='0x'+Math.random().toString(16).slice(2,10)+Math.random().toString(16).slice(2,10);
        STATUS.innerHTML='‚úÖ Mint successful (demo)\nRole: '+role+' | Qty: '+qty+'\nTx: <code style="font-size:14px;">'+fakeHash+'</code>';
        BTN_MINT.disabled=false;
      });
    })();
  </script>

  <!-- PHANTOM CONNECT -->
  <script>
    (function () {
      const btn = document.getElementById('connectBtn');
      if (!btn) return;
      const provider = window.solana || (window.phantom && window.phantom.solana) || null;

      function setInstall(){
        btn.textContent='Install Phantom';
        btn.onclick=()=>window.open('https://phantom.app/','_blank');
      }
      if (!provider || !provider.isPhantom){ setInstall(); return; }

      btn.textContent='Connect Wallet';
      btn.addEventListener('click', async ()=>{
        try{
          const resp = await provider.connect({ onlyIfTrusted:false });
          const pk = resp.publicKey.toString();
          const short = pk.slice(0,4)+'...'+pk.slice(-4);
          btn.textContent='Connected: '+short;
          btn.disabled=true; btn.classList.add('btn--connected');
        }catch{ alert('Wallet-Verbindung abgebrochen.'); }
      });

      if (provider.on){
        provider.on('connect', pk=>{
          const s=pk.toString(); const short=s.slice(0,4)+'...'+s.slice(-4);
          btn.textContent='Connected: '+short; btn.disabled=true; btn.classList.add('btn--connected');
        });
        provider.on('disconnect', ()=>{
          btn.textContent='Connect Wallet'; btn.disabled=false; btn.classList.remove('btn--connected');
        });
      }
    })();
  </script>

  <!-- GAME SCRIPT: Pixel Pac mit Name + Highscore + D-Pad -->
  <script>
  (function(){
    const TILE = 16;
    const COLS = 28;
    const ROWS = 31;

    const COLORS = {
      bg:'#000214',wall:'#0cc',pellet:'#9df',power:'#FFB347',
      pac:'#FFEF00',ghostR:'#ff4d4d',ghostP:'#ff68ff',
      ghostB:'#66a3ff',ghostO:'#ffb347',eyes:'#fff',
      fright:'#2aa',gate:'#66FAFF'
    };

    const cv=document.getElementById('pmCanvas');
    const cx=cv.getContext('2d');
    const scoreEl=document.getElementById('pmScore');
    const livesEl=document.getElementById('pmLives');
    const startBtn=document.getElementById('pmStart');
    const resetBtn=document.getElementById('pmReset');
    const overlay=document.getElementById('pmOverlay');
    const nameInput=document.getElementById('playerName');
    const scoreBody=document.getElementById('scoreBody');
    const lbEmpty=document.getElementById('lbEmpty');

    const BASE_MAP=[
      "1111111111111111111111111111",
      "1000000000110000000000000001",
      "1011110110110110110111111101",
      "1030000100000000000100000301",
      "1011110101111111100101111101",
      "1000000101000000100100000001",
      "1111100101011110100101111101",
      "2000100001000000100001000102",
      "1110101111114111111101010111",
      "1000101000000000000101000101",
      "1011101011110111110101110101",
      "1030001000000100000100000301",
      "1011101111100101111101111101",
      "1000000000100101000000000001",
      "1111111110100101011111111111",
      "2000000000100001000000000002",
      "1111111110111111011111111111",
      "1000000000000000000000000001",
      "1011111111110111111111111101",
      "1010000000030100000000000101",
      "1010111111110111111111100101",
      "1010000000000000000000100101",
      "1011111111111111111110100101",
      "1000000000000000000000100001",
      "1111111111111111111111111111"
    ];
    while(BASE_MAP.length<ROWS) BASE_MAP.push(BASE_MAP[BASE_MAP.length-1]);

    let grid,pac,ghosts,score=0,lives=3,pelletsLeft=0;
    let running=false,frightened=false,frightTimeout=null,ghostTimer=null;
    let ghostReleaseTimers=[],ghostReleased=[false,false,false,false];
    let highScores=[];

    function loadScores(){
      try{
        const raw=localStorage.getItem('fv_pac_scores');
        highScores = raw ? JSON.parse(raw) : [];
      }catch{highScores=[];}
      renderScores();
    }
    function saveScores(){
      try{localStorage.setItem('fv_pac_scores',JSON.stringify(highScores));}catch{}
    }
    function renderScores(){
      scoreBody.innerHTML='';
      if(!highScores.length){
        lbEmpty.style.display='block';return;
      }
      lbEmpty.style.display='none';
      highScores.forEach((s,i)=>{
        const tr=document.createElement('tr');
        const rank=document.createElement('td'); rank.textContent=i+1;
        const name=document.createElement('td'); name.textContent=s.name;
        const val=document.createElement('td'); val.textContent=s.score; val.className='score';
        tr.appendChild(rank);tr.appendChild(name);tr.appendChild(val);
        scoreBody.appendChild(tr);
      });
    }
    function recordScore(){
      if(score<=0) return;
      const name=(nameInput.value||'Anon').trim().slice(0,16)||'Anon';
      highScores.push({name,score,ts:Date.now()});
      highScores.sort((a,b)=>b.score-a.score || a.ts-b.ts);
      highScores=highScores.slice(0,10);
      saveScores();
      renderScores();
    }

    function initGrid(){
      grid=BASE_MAP.map(r=>r.split('').map(c=>+c));
      pelletsLeft=0;
      for(let r=0;r<ROWS;r++)
        for(let c=0;c<COLS;c++)
          if(grid[r][c]===0||grid[r][c]===3) pelletsLeft++;
    }
function initEntities(){
  // Pac-Man Start bleibt unten
  pac = { cx: 14, cy: 23 };

  // Geister jetzt im offenen Mittel-Korridor (Row 17 ist komplett frei)
  ghosts = [
    { cx: 12, cy: 17, color: COLORS.ghostR, home: { cx: 12, cy: 17 }, eyes: false },
    { cx: 14, cy: 17, color: COLORS.ghostP, home: { cx: 14, cy: 17 }, eyes: false },
    { cx: 16, cy: 17, color: COLORS.ghostB, home: { cx: 16, cy: 17 }, eyes: false },
    { cx: 18, cy: 17, color: COLORS.ghostO, home: { cx: 18, cy: 17 }, eyes: false },
  ];

  // Release-Logik bleibt, damit sie nacheinander ‚Äûaktiv‚Äú werden
  ghostReleased = [false, false, false, false];
}

    function inBounds(cx,cy){return cx>=0&&cx<COLS&&cy>=0&&cy<ROWS;}
    function isWallPac(cx,cy){
      if(!inBounds(cx,cy)) return true;
      const v=grid[cy][cx];
      return v===1||v===4;
    }
    function isWallGhost(cx,cy){
      if(!inBounds(cx,cy)) return true;
      const v=grid[cy][cx];
      return v===1; // gate (4) ist f√ºr Geister offen
    }

    function resetGame(full=true){
      if(full){score=0;lives=3;}
      running=false;frightened=false;
      if(frightTimeout)clearTimeout(frightTimeout);
      if(ghostTimer)clearInterval(ghostTimer);
      ghostReleaseTimers.forEach(t=>clearTimeout(t));
      ghostReleaseTimers=[];

      initGrid();initEntities();updateHUD();
      overlay.classList.remove('show');overlay.textContent='';
      scheduleGhostRelease();draw();
    }
    function updateHUD(){scoreEl.textContent=score;livesEl.textContent=lives;}
    function startGame(){
      if(running) return;
      running=true;overlay.classList.remove('show');
      ghostTimer=setInterval(stepGhosts,260);
    }
    function endGame(message){
      running=false;
      if(ghostTimer)clearInterval(ghostTimer);
      overlay.textContent=message+"  Press Reset to play again.";
      overlay.classList.add('show');
      recordScore();
    }

    function draw(){
      cx.fillStyle=COLORS.bg;cx.fillRect(0,0,cv.width,cv.height);
      for(let r=0;r<ROWS;r++){
        for(let c=0;c<COLS;c++){
          const v=grid[r][c],x=c*TILE,y=r*TILE;
          if(v===1){
            cx.fillStyle=COLORS.wall;cx.fillRect(x,y,TILE,TILE);
            cx.fillStyle="#001c1c";cx.fillRect(x+2,y+2,TILE-4,TILE-4);
          }else if(v===0){
            cx.fillStyle=COLORS.pellet;
            cx.beginPath();cx.arc(x+TILE/2,y+TILE/2,2,0,Math.PI*2);cx.fill();
          }else if(v===3){
            cx.fillStyle=COLORS.power;
            cx.beginPath();cx.arc(x+TILE/2,y+TILE/2,5,0,Math.PI*2);cx.fill();
          }else if(v===4){
            cx.fillStyle=COLORS.gate;
            cx.fillRect(x+2,y+TILE/2-1,TILE-4,2);
          }
        }
      }
      drawPac(pac.cx,pac.cy);
      ghosts.forEach(g=>drawGhost(g));
    }
    function drawPac(cxTile,cyTile){
      const x=cxTile*TILE+TILE/2,y=cyTile*TILE+TILE/2;
      cx.fillStyle=COLORS.pac;
      cx.beginPath();cx.arc(x,y,TILE*0.45,0,Math.PI*2);cx.fill();
    }
    function drawGhost(g){
      const x=g.cx*TILE,y=g.cy*TILE;
      const bodyColor=g.eyes?'#99c':(frightened?COLORS.fright:g.color);
      const r=TILE*0.45;
      cx.fillStyle=bodyColor;
      cx.beginPath();
      cx.arc(x+TILE/2,y+TILE/2,r,Math.PI,0);
      cx.lineTo(x+TILE*0.9,y+TILE*0.9);
      cx.lineTo(x+TILE*0.7,y+TILE*0.8);
      cx.lineTo(x+TILE*0.5,y+TILE*0.9);
      cx.lineTo(x+TILE*0.3,y+TILE*0.8);
      cx.lineTo(x+TILE*0.1,y+TILE*0.9);
      cx.closePath();cx.fill();
      cx.fillStyle=COLORS.eyes;
      cx.beginPath();cx.arc(x+TILE*0.42,y+TILE*0.46,2.5,0,Math.PI*2);cx.fill();
      cx.beginPath();cx.arc(x+TILE*0.58,y+TILE*0.46,2.5,0,Math.PI*2);cx.fill();
    }

    function movePac(dx,dy){
      if(!running) return;
      let nx=pac.cx+dx,ny=pac.cy+dy;
      if(isWallPac(nx,ny))return;
      if(nx<0)nx=COLS-1; if(nx>=COLS)nx=0;
      pac.cx=nx;pac.cy=ny;
      const cell=grid[ny][nx];
      if(cell===0){grid[ny][nx]=2;score+=10;pelletsLeft--;}
      else if(cell===3){grid[ny][nx]=2;score+=50;pelletsLeft--;triggerFright();}
      checkCollisions();updateHUD();
      if(pelletsLeft<=0)endGame("YOU WIN! üéâ");
      draw();
    }
    function triggerFright(){
      frightened=true;
      if(frightTimeout)clearTimeout(frightTimeout);
      frightTimeout=setTimeout(()=>{frightened=false;draw();},6000);
    }

    function ghostBlocked(g,nx,ny){return isWallGhost(nx,ny);}
    function scheduleGhostRelease(){
      ghostReleaseTimers.forEach(t=>clearTimeout(t));ghostReleaseTimers=[];
      ghostReleased=[false,false,false,false];
      ghostReleaseTimers.push(setTimeout(()=>ghostReleased[0]=true,500));
      ghostReleaseTimers.push(setTimeout(()=>ghostReleased[1]=true,1500));
      ghostReleaseTimers.push(setTimeout(()=>ghostReleased[2]=true,3000));
      ghostReleaseTimers.push(setTimeout(()=>ghostReleased[3]=true,4500));
    }
    function shuffle(arr){
      const copy=arr.slice();
      for(let i=copy.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [copy[i],copy[j]]=[copy[j],copy[i]];
      }
      return copy;
    }

    function stepGhosts(){
      if(!running)return;
      ghosts.forEach((g,i)=>{
        if(!ghostReleased[i]){
          const dirs=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];
          const valid=dirs.filter(o=>!ghostBlocked(g,g.cx+o.dx,g.cy+o.dy));
          if(valid.length){const o=valid[Math.floor(Math.random()*valid.length)];g.cx+=o.dx;g.cy+=o.dy;}
          return;
        }
        if(g.eyes){
          let dx=Math.sign(g.home.cx-g.cx),dy=Math.sign(g.home.cy-g.cy);
          const tryDirs=shuffle([{dx,dy:0},{dx:0,dy},{dx:-dx,dy:0},{dx:0,dy:-dy}]);
          for(const o of tryDirs){
            const nx=g.cx+o.dx,ny=g.cy+o.dy;
            if(!ghostBlocked(g,nx,ny)){g.cx=nx;g.cy=ny;break;}
          }
          if(g.cx===g.home.cx&&g.cy===g.home.cy)g.eyes=false;
          return;
        }
        const dirs=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];
        const valid=dirs.filter(o=>!ghostBlocked(g,g.cx+o.dx,g.cy+o.dy));
        if(!valid.length)return;
        let best;
        if(!frightened){
          let bestDist=Infinity;
          valid.forEach(o=>{
            const nx=g.cx+o.dx,ny=g.cy+o.dy;
            const d2=(nx-pac.cx)**2+(ny-pac.cy)**2;
            if(d2<bestDist){bestDist=d2;best=o;}
          });
        }else{
          let bestDist=-1;
          valid.forEach(o=>{
            const nx=g.cx+o.dx,ny=g.cy+o.dy;
            const d2=(nx-pac.cx)**2+(ny-pac.cy)**2;
            if(d2>bestDist){bestDist=d2;best=o;}
          });
        }
        if(!best)best=valid[Math.floor(Math.random()*valid.length)];
        let nx=g.cx+best.dx,ny=g.cy+best.dy;
        if(nx<0)nx=COLS-1;if(nx>=COLS)nx=0;
        g.cx=nx;g.cy=ny;
      });
      checkCollisions();draw();
    }

    function checkCollisions(){
      ghosts.forEach(g=>{
        if(g.cx===pac.cx&&g.cy===pac.cy){
          if(frightened&&!g.eyes){
            g.eyes=true;score+=200;updateHUD();
          }else if(!g.eyes){
            lives--;updateHUD();
            if(lives<=0){endGame("GAME OVER");}
            else{
              initEntities();scheduleGhostRelease();
              overlay.textContent="Life Lost";overlay.classList.add('show');
              setTimeout(()=>overlay.classList.remove('show'),700);
            }
          }
        }
      });
    }

    // Input
    window.addEventListener('keydown',e=>{
      const k=e.key.toLowerCase();
      if(!running)return;
      if(k==='arrowup'||k==='w')movePac(0,-1);
      else if(k==='arrowdown'||k==='s')movePac(0,1);
      else if(k==='arrowleft'||k==='a')movePac(-1,0);
      else if(k==='arrowright'||k==='d')movePac(1,0);
    });

    document.getElementById('btnUp').addEventListener('click',()=>movePac(0,-1));
    document.getElementById('btnDown').addEventListener('click',()=>movePac(0,1));
    document.getElementById('btnLeft').addEventListener('click',()=>movePac(-1,0));
    document.getElementById('btnRight').addEventListener('click',()=>movePac(1,0));

    startBtn.addEventListener('click',()=>startGame());
    resetBtn.addEventListener('click',()=>resetGame(true));

    loadScores();
    resetGame(true);
  })();
  </script>
</body>
</html>
